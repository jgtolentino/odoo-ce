<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Finance PPM TDI Security Groups -->

    <!-- Category for Finance PPM -->
    <record id="module_category_finance_ppm" model="ir.module.category">
        <field name="name">Finance PPM</field>
        <field name="description">Finance Project Portfolio Management</field>
        <field name="sequence">15</field>
    </record>

    <!-- User: Can view import history -->
    <record id="group_finance_ppm_user" model="res.groups">
        <field name="name">Finance PPM User</field>
        <field name="category_id" ref="module_category_finance_ppm"/>
        <field name="comment">Can view Finance PPM import history and audit logs</field>
    </record>

    <!-- Manager: Can import data -->
    <record id="group_finance_ppm_manager" model="res.groups">
        <field name="name">Finance PPM Manager</field>
        <field name="category_id" ref="module_category_finance_ppm"/>
        <field name="implied_ids" eval="[(4, ref('group_finance_ppm_user'))]"/>
        <field name="comment">Can import Finance PPM data (team, tasks, BIR, LogFrame)</field>
    </record>

    <!-- Administrator: Full access including cleanup and rollback -->
    <record id="group_finance_ppm_admin" model="res.groups">
        <field name="name">Finance PPM Administrator</field>
        <field name="category_id" ref="module_category_finance_ppm"/>
        <field name="implied_ids" eval="[(4, ref('group_finance_ppm_manager'))]"/>
        <field name="comment">Full access to Finance PPM TDI including cleanup and rollback</field>
    </record>

    <!-- Record Rules for Multi-Agency Access Control -->

    <!-- Rule: Users can view all audit logs -->
    <record id="finance_ppm_audit_user_rule" model="ir.rule">
        <field name="name">Finance PPM Audit: User Access</field>
        <field name="model_id" ref="model_finance_ppm_tdi_audit"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_finance_ppm_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Rule: Managers can create and update audit logs -->
    <record id="finance_ppm_audit_manager_rule" model="ir.rule">
        <field name="name">Finance PPM Audit: Manager Access</field>
        <field name="model_id" ref="model_finance_ppm_tdi_audit"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_finance_ppm_manager'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Rule: Admins have full access -->
    <record id="finance_ppm_audit_admin_rule" model="ir.rule">
        <field name="name">Finance PPM Audit: Admin Access</field>
        <field name="model_id" ref="model_finance_ppm_tdi_audit"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_finance_ppm_admin'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

</odoo>
