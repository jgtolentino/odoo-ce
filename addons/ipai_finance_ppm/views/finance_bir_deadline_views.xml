<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_finance_bir_deadline_tree" model="ir.ui.view">
        <field name="name">finance.bir.deadline.tree</field>
        <field name="model">finance.bir.deadline</field>
        <field name="arch" type="xml">
            <list string="BIR Deadlines" decoration-danger="state == 'pending'" decoration-warning="state == 'in_progress'" decoration-success="state == 'filed'">
                <field name="deadline_date" widget="remaining_days"/>
                <field name="name"/>
                <field name="period_covered"/>
                <field name="form_type" optional="hide"/>
                <field name="target_prep_date"/>
                <field name="target_report_approval_date"/>
                <field name="target_payment_approval_date"/>
                <field name="state" widget="badge" decoration-danger="state == 'pending'" decoration-warning="state == 'in_progress'" decoration-info="state == 'submitted'" decoration-success="state == 'filed'"/>
            </list>
        </field>
    </record>

    <!-- Calendar View -->
    <record id="view_finance_bir_deadline_calendar" model="ir.ui.view">
        <field name="name">finance.bir.deadline.calendar</field>
        <field name="model">finance.bir.deadline</field>
        <field name="arch" type="xml">
            <calendar string="BIR Deadline Calendar" date_start="deadline_date" color="form_type" mode="month">
                <field name="name"/>
                <field name="period_covered"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_finance_bir_deadline_form" model="ir.ui.view">
        <field name="name">finance.bir.deadline.form</field>
        <field name="model">finance.bir.deadline</field>
        <field name="arch" type="xml">
            <form string="BIR Deadline">
                <header>
                    <button name="action_send_reminder" type="object" string="ğŸ“¢ Send Reminder" class="btn-warning" help="Send immediate @mention notification to responsible team"/>
                    <button name="action_schedule_activities" type="object" string="ğŸ“… Schedule Activities" help="Create scheduled activities for all responsible persons"/>
                    <button name="action_mark_in_progress" type="object" string="Start Processing" class="oe_highlight" invisible="state != 'pending'"/>
                    <button name="action_mark_submitted" type="object" string="Mark Submitted" class="oe_highlight" invisible="state != 'in_progress'"/>
                    <button name="action_mark_filed" type="object" string="Mark Filed" class="oe_highlight" invisible="state != 'submitted'"/>
                    <field name="state" widget="statusbar" statusbar_visible="pending,in_progress,submitted,filed"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="BIR Form (e.g. 2550M)"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Basic Information">
                            <field name="period_covered" placeholder="e.g. October 2025"/>
                            <field name="form_type"/>
                            <field name="deadline_date"/>
                            <field name="sop_document_id" options="{'no_create': True}"/>
                        </group>
                        <group string="Computed Target Dates">
                            <field name="target_prep_date"/>
                            <field name="target_report_approval_date"/>
                            <field name="target_payment_approval_date"/>
                        </group>
                    </group>
                    <group>
                        <group string="Responsibility &amp; Contact">
                            <field name="responsible_prep_id"/>
                            <field name="responsible_review_id"/>
                            <field name="responsible_approval_id"/>
                        </group>
                        <group string="Settings">
                            <field name="active"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Description">
                            <field name="description" placeholder="Additional notes about this BIR form..."/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_finance_bir_deadline_search" model="ir.ui.view">
        <field name="name">finance.bir.deadline.search</field>
        <field name="model">finance.bir.deadline</field>
        <field name="arch" type="xml">
            <search string="Search BIR Deadlines">
                <field name="name"/>
                <field name="period_covered"/>
                <filter string="Pending" name="pending" domain="[('state', '=', 'pending')]"/>
                <filter string="In Progress" name="in_progress" domain="[('state', '=', 'in_progress')]"/>
                <filter string="Filed" name="filed" domain="[('state', '=', 'filed')]"/>
                <separator/>
                <filter string="Monthly" name="monthly" domain="[('form_type', '=', 'monthly')]"/>
                <filter string="Quarterly" name="quarterly" domain="[('form_type', '=', 'quarterly')]"/>
                <filter string="Annual" name="annual" domain="[('form_type', '=', 'annual')]"/>
                <separator/>
                <filter string="Upcoming (14 days)" name="upcoming" domain="[('deadline_date', '>=', context_today().strftime('%Y-%m-%d')), ('deadline_date', '&lt;=', (context_today() + datetime.timedelta(days=14)).strftime('%Y-%m-%d'))]"/>
                <group expand="0" string="Group By">
                    <filter string="Form Type" name="group_form_type" context="{'group_by': 'form_type'}"/>
                    <filter string="Status" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="Deadline Month" name="group_deadline" context="{'group_by': 'deadline_date:month'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Kanban View -->
    <record id="view_finance_bir_deadline_kanban" model="ir.ui.view">
        <field name="name">finance.bir.deadline.kanban</field>
        <field name="model">finance.bir.deadline</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" class="o_kanban_small_column">
                <field name="name"/>
                <field name="period_covered"/>
                <field name="deadline_date"/>
                <field name="state"/>
                <templates>
                    <t t-name="card">
                        <field name="name" class="fw-bold"/>
                        <div class="text-muted small">
                            <field name="period_covered"/>
                        </div>
                        <div class="mt-2">
                            <field name="deadline_date" widget="remaining_days"/>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Action -->
    <record id="action_finance_bir_deadline" model="ir.actions.act_window">
        <field name="name">BIR Deadlines</field>
        <field name="res_model">finance.bir.deadline</field>
        <field name="view_mode">list,calendar,kanban,form</field>
        <field name="context">{'search_default_pending': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first BIR deadline
            </p>
            <p>
                Track BIR filing deadlines with automatic computation of preparation,
                review, and approval target dates.
            </p>
        </field>
    </record>
</odoo>
