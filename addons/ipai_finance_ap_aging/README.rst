====================
IPAI Finance AP Aging
====================

.. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
    :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
    :alt: License: AGPL-3

|badge1| |badge2|

AP Aging Heatmap Automation for Month-End Close
================================================

This module provides comprehensive AP Aging automation with visual heatmap analytics,
n8n workflow integration, and automated month-end close support.

**Features**:

* Automated AP Aging bucket calculations (0-30, 31-60, 61-90, 90+ days)
* Employee-specific context filtering (RIM, CKVC, etc.)
* ECharts interactive heatmap visualization
* Daily cron job automation (9 AM PHT)
* n8n webhook integration for task queue automation
* Mattermost notifications for month-end close reviewers
* Print Report and Excel export functionality
* Visual parity validation (SSIM ≥ 0.97 mobile, ≥ 0.98 desktop)

**Table of contents**

.. contents::
   :local:

Installation
============

To install this module, you need to:

#. Clone the repository into your Odoo addons directory
#. Update the module list in Odoo
#. Install the module from Apps menu

Configuration
=============

After installation, configure the following:

**1. n8n Webhook URL**

Set the webhook URL in System Parameters:

* Navigate to: Settings → Technical → Parameters → System Parameters
* Key: ``ipai_finance_ap_aging.n8n_webhook_url``
* Value: ``https://ipa.insightpulseai.net/webhook/ap-aging-webhook``

**2. Cron Job Schedule**

The cron job runs daily at 9 AM PHT (1 AM UTC). To modify:

* Navigate to: Settings → Technical → Automation → Scheduled Actions
* Find: "AP Aging RIM - Daily Snapshot (9 AM PHT)"
* Adjust schedule as needed

**3. Mattermost Webhook**

Configure Mattermost webhook in n8n workflow:

* Edit workflow: ``W403_AP_AGING_HEATMAP``
* Update webhook URL in "Notify Mattermost (CKVC)" node

Usage
=====

**Viewing the Heatmap**

#. Navigate to: Accounting → AP Aging → Aging Heatmap
#. Or access directly: ``/ipai/finance/ap_aging/heatmap?employee_code=RIM``

**Manual Snapshot Generation**

#. Navigate to: Accounting → Vendors → Vendor Bills
#. Select: Actions → Generate AP Aging Heatmap Now

**Interpreting the Heatmap**

* **X-Axis**: Aging buckets (0-30, 31-60, 61-90, 90+ days)
* **Y-Axis**: Top 20 vendors by total outstanding payables
* **Color Intensity**: Payment amount (green = low, yellow = medium, red = high)
* **KPI Cards**: Total payables, vendor count, overdue (90+) amount

**Print Report**

Click "Print Report" button to generate printable version with visual formatting.

**Export to Excel**

Click "Export to Excel" to download CSV file with detailed vendor aging data.

Technical Details
=================

**Database Query Performance**

The module uses optimized SQL queries with indexes on:

* ``account_move_line`` (account_id, partner_id, reconciled, amount_residual)
* ``account_move_line`` (date_maturity)

**n8n Workflow Integration**

Webhook payload structure:

.. code-block:: json

    {
      "employee_code": "RIM",
      "snapshot_date": "2025-11-25",
      "vendors": [
        {
          "partner_id": 123,
          "vendor_name": "Example Vendor",
          "bucket_0_30": 50000.00,
          "bucket_31_60": 120000.00,
          "bucket_61_90": 0.00,
          "bucket_90_plus": 30000.00,
          "total_outstanding": 200000.00
        }
      ],
      "total_payables": 200000.00,
      "total_overdue_90plus": 30000.00,
      "vendor_count": 1
    }

**API Endpoints**

* ``/ipai/finance/ap_aging/heatmap`` - HTML heatmap visualization
* ``/ipai/finance/ap_aging/api/data`` - JSON data endpoint
* ``/ipai/finance/ap_aging/api/summary`` - JSON summary KPIs

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/jgtolentino/odoo-ce/issues>`_.
In case of trouble, please check there if your issue has already been reported.

Credits
=======

Authors
~~~~~~~

* InsightPulse AI

Contributors
~~~~~~~~~~~~

* Jake Tolentino <jgtolentino@insightpulseai.net>

Maintainers
~~~~~~~~~~~

This module is maintained by InsightPulse AI.

.. image:: https://insightpulseai.net/logo.png
   :alt: InsightPulse AI
   :target: https://insightpulseai.net

This module is part of the `odoo-ce <https://github.com/jgtolentino/odoo-ce>`_ project on GitHub.

You are welcome to contribute.
