# InsightPulse AI - Agent Skills Registry
# Version: 1.0.0
# Purpose: Master capability map derived from Odoo CE + Supabase + n8n + K8s stack
# Aligned to: Microsoft Learn → Agent Capability transformation pattern

id: insightpulse_ai_agent_registry
version: 1.0.0
created: 2025-11-22
status: active
owner: InsightPulseAI Platform Team

# ============================================================================
# DOMAINS - Major capability areas
# ============================================================================
domains:
  - odoo_ce              # Odoo Community Edition operations
  - supabase             # Supabase database + storage
  - n8n                  # Workflow automation
  - ocr_ml               # OCR + AI/ML inference
  - deployment           # Infrastructure + deployment
  - finance_ops          # Finance operations + closing
  - mobile               # Mobile client development

# ============================================================================
# SKILLS - Atomic capabilities the agent can execute
# ============================================================================
skills:
  # --- Odoo CE Skills ---
  - id: scaffold_odoo_module
    name: "Scaffold Odoo Module"
    domain: odoo_ce
    description: "Create new Odoo CE module with manifest, models, views, security"
    inputs:
      - module_name
      - category
      - dependencies
    outputs:
      - module_directory
      - __manifest__.py
      - models/
      - views/
      - security/
    tools:
      - odoo_scaffold
      - python
      - xml
    knowledge_refs:
      - odoo_oca_patterns
      - odoo_ce_18_docs

  - id: deploy_odoo_module
    name: "Deploy Odoo Module to Production"
    domain: odoo_ce
    description: "Rsync module, upgrade, restart Odoo container"
    inputs:
      - module_name
      - target_host
    outputs:
      - deployment_log
    tools:
      - rsync
      - ssh
      - docker
    preconditions:
      - odoo_instance_running
      - module_passes_lint

  - id: create_odoo_automation
    name: "Create Odoo Automation Rule"
    domain: odoo_ce
    description: "Create automated actions for model triggers"
    inputs:
      - model_name
      - trigger_type
      - action
    outputs:
      - ir.cron or ir.actions.server record

  - id: analyze_odoo_logs
    name: "Analyze Odoo Error Logs"
    domain: odoo_ce
    description: "Parse Odoo logs, identify errors, suggest fixes"
    inputs:
      - log_file_path
    outputs:
      - error_summary
      - suggested_fixes

  # --- Supabase Skills ---
  - id: create_supabase_schema
    name: "Generate Supabase Schema"
    domain: supabase
    description: "Create PostgreSQL tables with RLS policies"
    inputs:
      - table_name
      - columns
      - rls_policies
    outputs:
      - migration_sql
    tools:
      - supabase_cli
      - postgresql

  - id: setup_supabase_storage
    name: "Setup Supabase Storage Bucket"
    domain: supabase
    description: "Create storage bucket with RLS policies"
    inputs:
      - bucket_name
      - access_level
      - rls_policies
    outputs:
      - bucket_config

  # --- n8n Skills ---
  - id: create_n8n_workflow
    name: "Create n8n Workflow"
    domain: n8n
    description: "Generate n8n workflow JSON from specification"
    inputs:
      - workflow_spec
      - domain_code
    outputs:
      - workflow_json
      - workflow_id
    tools:
      - n8n_cli
      - jq
    knowledge_refs:
      - n8n_workflow_conventions
      - odoo_jsonrpc_patterns

  - id: deploy_n8n_workflow
    name: "Deploy n8n Workflow"
    domain: n8n
    description: "Import workflow to n8n instance"
    inputs:
      - workflow_json_path
    outputs:
      - workflow_url
    tools:
      - n8n_cli
    preconditions:
      - n8n_instance_running

  # --- OCR/ML Skills ---
  - id: test_ocr_quality
    name: "Test OCR Quality"
    domain: ocr_ml
    description: "Run OCR test harness against ground truth"
    inputs:
      - test_images_dir
      - ground_truth_csv
    outputs:
      - quality_report
      - accuracy_metrics
    tools:
      - python
      - test_harness_script
    knowledge_refs:
      - ocr_quality_standards
      - ph_receipt_patterns

  - id: add_ocr_normalization
    name: "Add OCR Normalization Rule"
    domain: ocr_ml
    description: "Add vendor/date/currency normalization to OCR adapter"
    inputs:
      - normalization_type
      - pattern
      - canonical_value
    outputs:
      - updated_main_py

  # --- Deployment Skills ---
  - id: deploy_to_digitalocean
    name: "Deploy to DigitalOcean"
    domain: deployment
    description: "Deploy service to DigitalOcean droplet or App Platform"
    inputs:
      - service_type
      - config_files
    outputs:
      - deployment_url
      - service_status
    tools:
      - doctl
      - ssh
      - docker

  - id: setup_nginx_proxy
    name: "Setup Nginx Reverse Proxy"
    domain: deployment
    description: "Configure nginx with SSL for service"
    inputs:
      - domain_name
      - backend_port
    outputs:
      - nginx_config
      - ssl_cert_status
    tools:
      - nginx
      - certbot

  - id: run_ci_checks
    name: "Run CI/CD Checks"
    domain: deployment
    description: "Execute CE/OCA guardrails, linting, tests"
    inputs:
      - repo_path
    outputs:
      - check_results
    tools:
      - github_actions
      - ruff
      - pylint

  - id: fix_oca_ci_violations
    name: "Fix OCA CI/CD Violations"
    domain: deployment
    description: "Automatically diagnose and fix CI/CD pipeline issues for Odoo CE/OCA repositories"
    inputs:
      - repo_snapshot
      - ci_logs
      - target_branches
    outputs:
      - corrected_workflows
      - fix_report
      - pr_patch
    tools:
      - github_actions
      - yaml_parser
      - python_ast
    knowledge_refs:
      - odoo_oca_patterns
      - odoo_ce_18_docs
      - oca_maintainer_tools

  # --- Finance Ops Skills ---
  - id: import_monthly_tasks
    name: "Import Monthly Closing Tasks"
    domain: finance_ops
    description: "Import month-end tasks from CSV to Odoo projects"
    inputs:
      - csv_path
      - month_offset
    outputs:
      - task_count
      - project_id
    knowledge_refs:
      - finance_closing_templates
      - bir_filing_calendar

  - id: send_bir_alerts
    name: "Send BIR Deadline Alerts"
    domain: finance_ops
    description: "Check BIR deadlines, send Mattermost/email alerts"
    inputs:
      - alert_days_before
    outputs:
      - alerts_sent
    tools:
      - n8n
      - mattermost_webhook

  # --- Mobile Skills ---
  - id: build_flutter_module
    name: "Build Flutter Module"
    domain: mobile
    description: "Build Flutter module for Android/iOS"
    inputs:
      - module_path
      - platform
    outputs:
      - apk_path or ipa_path
    tools:
      - flutter

  - id: test_flutter_integration
    name: "Test Flutter-Supabase Integration"
    domain: mobile
    description: "Run integration tests for Flutter + Supabase"
    inputs:
      - test_suite_path
    outputs:
      - test_results
    tools:
      - flutter_test
      - supabase_test_client

# ============================================================================
# CAPABILITIES - Composite workflows combining multiple skills
# ============================================================================
capabilities:
  - id: build_enterprise_module
    name: "Build Enterprise Odoo Module"
    description: "End-to-end creation of production-ready Odoo module"
    skills:
      - scaffold_odoo_module
      - run_ci_checks
      - deploy_odoo_module
    preconditions:
      - odoo_instance_available
      - ci_pipeline_green
    validation:
      - module_installable
      - no_enterprise_dependencies
      - all_tests_pass

  - id: setup_ocr_pipeline
    name: "Setup Complete OCR Pipeline"
    description: "Deploy OCR adapter + Odoo module + quality testing"
    skills:
      - deploy_to_digitalocean
      - deploy_odoo_module
      - create_supabase_schema
      - test_ocr_quality
    outputs:
      - ocr_endpoint_url
      - quality_baseline

  - id: automate_finance_closing
    name: "Automate Monthly Finance Closing"
    description: "Deploy n8n workflows for finance automation"
    skills:
      - import_monthly_tasks
      - create_n8n_workflow
      - deploy_n8n_workflow
      - send_bir_alerts
    knowledge_refs:
      - finance_closing_playbook
      - bir_compliance_rules

  - id: deploy_mobile_ocr
    name: "Deploy Mobile OCR Client"
    description: "Build and deploy Flutter OCR app"
    skills:
      - build_flutter_module
      - setup_supabase_storage
      - test_flutter_integration
    outputs:
      - mobile_app_download_url

  - id: cheqroom_parity_equipment_ce
    name: "Cheqroom-Style Equipment Management on Odoo CE"
    description: "Maintain and extend ipai_equipment module providing Cheqroom-grade equipment catalog, booking, calendar, overlap prevention, overdue alerts, and utilization reports on Odoo 18 CE"
    skills:
      - scaffold_odoo_module
      - deploy_odoo_module
      - analyze_odoo_logs
      - create_n8n_workflow
    features:
      - equipment_catalog_with_conditions
      - booking_calendar_with_overlap_prevention
      - overdue_notifications_via_cron
      - utilization_reports_pivot_graph
      - incident_tracking
      - mail_activities_integration
    preconditions:
      - odoo_ce_18_with_stock_maintenance_project
      - mail_module_installed
    validation:
      - booking_sequence_exists
      - calendar_view_functional
      - overdue_cron_creates_activities
      - overlap_constraint_enforced
    knowledge_refs:
      - cheqroom_parity_documentation
      - ipai_equipment_tests

  - id: concur_parity_expense_ce
    name: "SAP Concur-Style Expense Management on Odoo CE"
    description: "Maintain and extend the ipai_expense + ipai_cash_advance + ipai_ocr_expense stack to provide Concur-grade expense capture, OCR, approvals, and integration into monthly closing via ipai_finance_monthly_closing"
    skills:
      - deploy_odoo_module
      - test_ocr_quality
      - create_n8n_workflow
      - analyze_odoo_logs
    features:
      - expense_capture_with_ocr
      - cash_advance_and_settlement
      - approval_workflows
      - monthly_closing_integration
      - n8n_workflow_automation
      - vendor_normalization
    preconditions:
      - odoo_ce_18_running
      - modules_installed_ipai_expense_cash_advance_ocr_finance_closing
      - ocr_adapter_reachable
    validation:
      - ocr_pipeline_functional
      - cash_advance_settlement_works
      - monthly_closing_includes_expenses
      - approval_workflow_enforced
    knowledge_refs:
      - concur_parity_documentation
      - ipai_expense_tests

  - id: workspace_parity_docs_projects_ce
    name: "Notion-Style Workspace on Odoo CE"
    description: "Replace Notion workspace with ipai_docs, ipai_docs_project, and project/task modules so that docs, projects, and tasks live in Odoo CE with full visibility in project boards, My Tasks, and mobile app activities"
    skills:
      - deploy_odoo_module
      - create_odoo_automation
      - analyze_odoo_logs
    features:
      - document_management
      - project_doc_linkage
      - task_templates
      - my_tasks_view
      - mobile_app_activities
      - mention_notifications
    preconditions:
      - odoo_ce_18_running
      - modules_installed_ipai_docs_ipai_docs_project_project
      - outgoing_email_configured
    validation:
      - docs_project_linkage_works
      - task_visibility_across_views
      - email_mobile_notifications_sent
      - mention_system_functional
    knowledge_refs:
      - workspace_parity_documentation
      - ipai_docs_tests

  - id: saas_parity_reverse_mapper
    name: "SaaS → Odoo CE Reverse Mapping Agent"
    description: "Autonomous agent that reverse-engineers SaaS products into Odoo CE/OCA/ipai modules by mapping features, identifying gaps, generating PRDs, scaffolding modules, and deploying with full CI/CD integration"
    skills:
      - scaffold_odoo_module
      - deploy_odoo_module
      - create_supabase_schema
      - create_n8n_workflow
      - deploy_n8n_workflow
      - run_ci_checks
    features:
      - saas_feature_discovery
      - ce_oca_module_mapping
      - enterprise_gap_identification
      - prd_generation
      - module_scaffolding
      - automated_deployment
      - artifact_tracking
    preconditions:
      - supabase_feature_matrix_schema_exists
      - enterprise_feature_gap_yaml_exists
      - odoo_ce_18_running
      - n8n_instance_available
    validation:
      - feature_coverage_gt_90_percent
      - all_regression_tests_pass
      - artifacts_tracked_in_supabase
      - ci_cd_pipeline_green
    knowledge_refs:
      - enterprise_feature_gap
      - saas_feature_matrix
      - odoo_reverse_mapper_spec

  - id: oca_ci_guardian
    name: "OCA CI Guardian - Automated CI/CD Fixer"
    description: "Autonomous agent that audits, fixes, and maintains GitHub Actions workflows for Odoo 18 CE and OCA-style repositories. Enforces OCA conventions, prevents Enterprise contamination, and keeps CI pipelines green."
    skills:
      - fix_oca_ci_violations
      - run_ci_checks
      - deploy_odoo_module
      - analyze_odoo_logs
    features:
      - enterprise_contamination_detection
      - oca_compliance_enforcement
      - workflow_auto_repair
      - openupgrade_compatibility_validation
      - automated_pr_generation
    preconditions:
      - github_repository_exists
      - workflows_directory_present
    validation:
      - no_enterprise_dependencies
      - all_ci_checks_pass
      - oca_structure_compliant
      - workflows_valid_yaml
    knowledge_refs:
      - odoo_oca_patterns
      - odoo_ce_18_docs
      - oca_maintainer_tools
      - oca_ci_guardian_docs

# ============================================================================
# PROCEDURES - High-level orchestration macros
# ============================================================================
procedures:
  build_new_feature:
    description: "End-to-end feature development workflow"
    steps:
      - "Understand requirement from user"
      - "Map requirement to Odoo CE + edge systems"
      - "Generate code scaffold using relevant skills"
      - "Run tests and CI checks"
      - "Deploy to staging/production"
      - "Notify stakeholders via Mattermost/n8n"
    validation:
      - "AI validator checks code quality"
      - "Odoo test suite passes"
      - "GitHub CI checks green"
      - "No Enterprise/IAP dependencies introduced"

  investigate_production_issue:
    description: "Debug production issues"
    steps:
      - "Analyze Odoo logs using analyze_odoo_logs skill"
      - "Check OCR quality metrics if OCR-related"
      - "Review n8n workflow execution logs"
      - "Identify root cause"
      - "Propose fix + create patch"
      - "Deploy fix + validate"

  onboard_new_automation:
    description: "Add new n8n automation workflow"
    steps:
      - "Define workflow specification"
      - "Create workflow JSON using n8n conventions"
      - "Test workflow in n8n staging"
      - "Deploy to production n8n instance"
      - "Document in workflow registry"
      - "Add to knowledge base"

  ensure_ipai_equipment_schema:
    description: "Ensure ipai_equipment module has complete schema"
    steps:
      - "Verify ipai.equipment.asset model has all Cheqroom fields (status, condition, location, image)"
      - "Verify ipai.equipment.booking model with mail.thread + mail.activity.mixin"
      - "Verify ipai.equipment.incident model exists"
      - "Check security/ir.model.access.csv has all 3 models"
      - "Validate views include tree, form, calendar, graph, pivot"

  ensure_booking_calendar_and_overlap_guard:
    description: "Ensure booking calendar and overlap prevention"
    steps:
      - "Verify calendar view exists in ipai_equipment_views.xml with date_start/date_stop"
      - "Verify _check_booking_conflict constraint in booking model"
      - "Test overlap prevention by creating conflicting bookings"
      - "Confirm error raised for same asset + overlapping dates"

  ensure_overdue_cron_and_activities:
    description: "Ensure overdue cron + activities for equipment bookings"
    steps:
      - "Open addons/ipai_equipment/models/equipment.py and verify _cron_check_overdue_bookings exists"
      - "Verify activity creation logic uses mail.mail_activity_data_todo and borrower_id"
      - "Verify data/ipai_equipment_cron.xml is loaded in __manifest__.py"
      - "Deploy ipai_equipment via scripts/deploy-odoo-modules.sh ipai_equipment"
      - "Run cron manually from Scheduled Actions and confirm activities appear"

  run_cheqroom_uat_script:
    description: "Run Cheqroom UAT on ipai_equipment"
    steps:
      - "Upgrade ipai_equipment in Odoo UI (Apps → Search → Upgrade)"
      - "Create 3 assets: Sony A7S3 #1, Sony A7S3 #2, DJI Gimbal #1"
      - "Create booking EQB00001, test reserve/check-out/return state transitions"
      - "Test overlap error for same asset with overlapping dates"
      - "Create overdue booking (past end_datetime, state=checked_out)"
      - "Run cron manually, verify activity created for borrower"
      - "Verify calendar view shows bookings as colored blocks"
      - "Verify utilization pivot/graph views functional"

  ensure_expense_ocr_pipeline:
    description: "Ensure expense OCR pipeline is working end-to-end"
    steps:
      - "Verify ipai_ocr_expense is installed and upgraded in Odoo"
      - "Open an expense form and confirm OCR fields/buttons are present"
      - "Upload a sample receipt, trigger OCR, and verify vendor/amount/date fields are populated"
      - "Check Odoo logs + OCR adapter logs for errors"

  ensure_cash_advance_and_settlement:
    description: "Ensure cash advance and settlement flow"
    steps:
      - "Create cash advance via ipai_cash_advance for a test user"
      - "Submit and approve the advance; verify accounting entries"
      - "Submit expenses linked to that advance and settle the balance"
      - "Confirm the remaining balance and GL postings are correct"

  ensure_monthly_closing_hooks:
    description: "Ensure monthly closing sees OCR'd expenses"
    steps:
      - "Run ipai_finance_monthly_closing in a test DB for a given period"
      - "Confirm OCR'd expenses are included in the closing views/reports"
      - "Check that n8n monthly-close workflows consume the same data"
      - "Verify no blocking errors in scheduled actions or logs"

  run_concur_uat_script:
    description: "Run SAP Concur parity UAT"
    steps:
      - "Create a standard employee user and manager"
      - "Submit 3 expenses (meal, transport, per diem) with receipts"
      - "Route through approval workflow; post to accounting"
      - "Confirm OCR filled in vendor/amount/date on at least 2/3 receipts"
      - "Validate resulting journal entries vs PH policy expectations"

  ensure_docs_project_linkage:
    description: "Ensure docs ↔ projects linkage behaves like a Notion workspace"
    steps:
      - "Verify ipai_docs and ipai_docs_project are installed"
      - "Open a project and confirm linked docs smart button or section exists"
      - "Create a doc from the project; check the project back-link on the doc"
      - "Link an existing doc to a project and verify both sides show the relationship"

  ensure_task_visibility_and_mentions:
    description: "Ensure tasks are visible across workspace views"
    steps:
      - "Create a project from template and generate tasks"
      - "Verify tasks show in: project kanban, My Tasks, and Activities"
      - "Use @mention in task chatter to assign work to a user"
      - "Confirm mentioned user sees it in their to-do and mobile app activities"

  ensure_email_mobile_notifications:
    description: "Ensure email and mobile notifications for workspace actions"
    steps:
      - "Confirm outgoing email server config is valid"
      - "Create a task with a due date and @mention a user"
      - "Verify an email notification is sent to that user"
      - "Open Odoo mobile app; verify the activity appears for that user"

  run_workspace_uat_script:
    description: "Run Notion workspace parity UAT"
    steps:
      - "Create project 'Monthly Closing – <Month>' in Odoo"
      - "Attach SOP / policy docs via ipai_docs_project"
      - "Generate all closing tasks via template and assign initial owners"
      - "Filter tasks by assignee/company/stage to simulate Notion DB views"
      - "Check that all assigned users see their tasks and activities on mobile"

  saas_collect_requirements:
    description: "Discover SaaS features and analyze implementation requirements"
    steps:
      - "Query Supabase saas_feature_mappings for GAP features with criticality >= 3"
      - "Fetch SaaS product documentation and API specifications"
      - "Extract UI patterns from screenshots using Playwright"
      - "Identify data models, workflows, and state machines"
      - "Document requirements in structured format"

  saas_map_to_odoo_modules:
    description: "Map SaaS features to existing Odoo CE/OCA modules"
    steps:
      - "Query Odoo CE for installed core modules via odoo-bin shell"
      - "Search OCA repositories for community modules addressing features"
      - "Calculate feature coverage gap: (required - covered) / required"
      - "Reference Enterprise equivalents from ENTERPRISE_FEATURE_GAP.yaml"
      - "Generate gap summary table: Feature | Status | CE | OCA | Enterprise | Requires"

  saas_identify_enterprise_gaps:
    description: "Identify gaps requiring ipai_* module development"
    steps:
      - "Filter features with gap_score > 0.2 requiring custom modules"
      - "Document Enterprise module equivalents without installing them"
      - "Update ENTERPRISE_FEATURE_GAP.yaml with new gap entries"
      - "Prioritize gaps by criticality and cost-benefit analysis"

  saas_emit_ipai_blueprints:
    description: "Generate PRDs, scaffold modules, and deploy"
    steps:
      - "Generate comprehensive PRD from feature specifications"
      - "Run odoo-bin scaffold <module_name> addons"
      - "Create models, views, data, security, tests from PRD"
      - "Write feature parity documentation (FEATURE_*_PARITY.md)"
      - "Commit to Git with conventional message"
      - "Deploy via ./scripts/deploy-odoo-modules.sh"
      - "Run regression tests: odoo-bin -d test_<product> -i <module> --test-enable"
      - "Update Supabase: status='covered', insert artifact records"
      - "Create GitHub issue for production deployment"

# ============================================================================
# KNOWLEDGE SOURCES - References for agent learning
# ============================================================================
knowledge_sources:
  - id: odoo_oca_patterns
    type: documentation
    location: "https://odoo-community.org/"
    description: "OCA module patterns and best practices"

  - id: odoo_ce_18_docs
    type: documentation
    location: "/home/user/odoo-ce/docs/"
    description: "Odoo CE 18 internal documentation"

  - id: n8n_workflow_conventions
    type: specification
    location: "/home/user/odoo-ce/notion-n8n-monthly-close/WORKFLOW_CONVENTIONS.md"
    description: "n8n naming and structure conventions"

  - id: ocr_quality_standards
    type: specification
    location: "/home/user/odoo-ce/ODOO_OCR_SETUP.md"
    description: "OCR quality SLOs and normalization patterns"

  - id: ph_receipt_patterns
    type: knowledge
    location: "ocr-adapter/main.py"
    description: "PH vendor normalization and receipt patterns"

  - id: finance_closing_playbook
    type: runbook
    location: "/home/user/odoo-ce/specs/002-odoo-expense-equipment-mvp.prd.md"
    description: "Finance closing workflows and BIR requirements"

  - id: insightpulse_standards
    type: standards
    location: "/home/user/odoo-ce/spec.md"
    description: "InsightPulse CE/OCA-only standards"

  - id: module_service_matrix
    type: architecture
    location: "/home/user/odoo-ce/specs/MODULE_SERVICE_MATRIX.md"
    description: "Complete platform integration map"

  - id: cheqroom_parity_documentation
    type: documentation
    location: "/home/user/odoo-ce/docs/FEATURE_CHEQROOM_PARITY.md"
    description: "Cheqroom parity feature documentation and UAT script"

  - id: ipai_equipment_tests
    type: tests
    location: "/home/user/odoo-ce/addons/ipai_equipment/tests/"
    description: "ipai_equipment regression tests for booking lifecycle"

  - id: concur_parity_documentation
    type: documentation
    location: "/home/user/odoo-ce/docs/FEATURE_CONCUR_PARITY.md"
    description: "SAP Concur parity feature documentation and UAT script"

  - id: ipai_expense_tests
    type: tests
    location: "/home/user/odoo-ce/addons/ipai_expense/tests/"
    description: "ipai_expense regression tests for OCR and expense lifecycle"

  - id: workspace_parity_documentation
    type: documentation
    location: "/home/user/odoo-ce/docs/FEATURE_WORKSPACE_PARITY.md"
    description: "Notion workspace parity feature documentation and UAT script"

  - id: ipai_docs_tests
    type: tests
    location: "/home/user/odoo-ce/addons/ipai_docs/tests/"
    description: "ipai_docs regression tests for workspace visibility and linkage"

  - id: enterprise_feature_gap
    type: documentation
    location: "/home/user/odoo-ce/docs/ENTERPRISE_FEATURE_GAP.yaml"
    description: "Central specification mapping SaaS products to Enterprise equivalents without installing them"

  - id: saas_feature_matrix
    type: database
    location: "supabase://saas_feature_mappings"
    description: "Supabase tables tracking SaaS features → Odoo CE/OCA/ipai mapping with artifact tracking"

  - id: odoo_reverse_mapper_spec
    type: specification
    location: "/home/user/odoo-ce/agents/odoo_reverse_mapper.yaml"
    description: "Complete reverse mapping agent specification with capabilities, workflows, and validation"

  - id: oca_maintainer_tools
    type: tools
    location: "https://github.com/OCA/maintainer-tools"
    description: "OCA maintainer tools for CI/CD, code quality, and repository management"

  - id: oca_ci_guardian_docs
    type: documentation
    location: "/home/user/odoo-ce/docs/deployment/OCA_CI_GUARDIAN.md"
    description: "OCA CI Guardian agent documentation with troubleshooting and examples"

# ============================================================================
# EXECUTION RULES - Decision logic for autonomous operation
# ============================================================================
execution_rules:
  - rule: "Always prefer CE/OCA over Enterprise"
    condition: "when: module selection needed"
    action: "reject Enterprise dependencies, suggest CE/OCA alternatives"

  - rule: "Validate no odoo.com links"
    condition: "when: code changes touch UI/templates"
    action: "run CI check for odoo.com references before commit"

  - rule: "Test OCR quality after normalization changes"
    condition: "when: ocr-adapter/main.py modified"
    action: "run test_ocr_quality skill automatically"

  - rule: "Deploy via M1 script for infrastructure changes"
    condition: "when: deploy/ directory modified"
    action: "use deploy_m1.sh.template workflow"

  - rule: "Follow n8n naming conventions"
    condition: "when: creating new n8n workflow"
    action: "use WNNN_DD_DESCRIPTION pattern from WORKFLOW_CONVENTIONS.md"

  - rule: "Isolate user data with RLS"
    condition: "when: creating Supabase tables"
    action: "always add Row Level Security policies"

  - rule: "Rate limit external API calls"
    condition: "when: integrating external services"
    action: "implement rate limiting (e.g., 100 req/hour for OCR)"

# ============================================================================
# STACK CONFIGURATION - Actual deployed services
# ============================================================================
stack:
  odoo:
    url: "https://erp.insightpulseai.net"
    version: "18.0 CE"
    custom_modules:
      - ipai_expense
      - ipai_equipment
      - ipai_ocr_expense
      - ipai_finance_monthly_closing
      - ipai_ce_cleaner
      - flutter_receipt_ocr

  supabase:
    project_id: "spdtwktxdalcfigzeqrz"
    region: "us-east-1"
    tables:
      - parsed_receipts
    buckets:
      - receipt-images

  ocr_service:
    url: "https://ocr.insightpulseai.net"
    backend: "PaddleOCR-VL-900M"
    llm: "OpenAI GPT-4o-mini"

  n8n:
    workspace: "fin-workspace"
    workflows_repo: "notion-n8n-monthly-close/workflows/"

  infrastructure:
    platform: "DigitalOcean"
    compute:
      - odoo-erp-prod (Odoo + PostgreSQL)
      - ocr-service-droplet (OCR backend)
    deployment_method: "Docker Compose + M1 script"

# ============================================================================
# METRICS - Success criteria for agent operations
# ============================================================================
metrics:
  ocr_quality:
    target: ">= 85% success rate"
    measurement: "Query ocr.expense.log for status='success'"

  deployment_speed:
    target: "< 5 minutes for module deployment"
    measurement: "Time from rsync to Odoo restart"

  ci_reliability:
    target: "100% pass rate for CE/OCA checks"
    measurement: "GitHub Actions workflow success"

  automation_coverage:
    target: ">= 80% of repetitive tasks automated"
    measurement: "Count of n8n workflows vs manual processes"
